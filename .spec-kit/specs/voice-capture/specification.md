# VoiceCapture - 機能仕様書

**プロジェクト名**: VoiceCapture
**機能名**: voice-capture
**作成日**: 2025-10-03
**バージョン**: 1.0.0
**ステータス**: 仕様定義完了

---

## 1. プロジェクト概要

### 1.1 何を作るか（WHAT）

**VoiceCapture**は、思考を音声で即座に記録し、自動で文字起こしして整理するmacOSメニューバーアプリケーションである。

**コア機能**:
1. グローバルホットキーによる録音開始/停止
2. リアルタイム視覚的フィードバック（音量レベルメーター）
3. WAV形式での自動保存
4. MLX Whisperによる自動文字起こし
5. Markdown形式での出力と保存

### 1.2 なぜ作るか（WHY）

**解決したい課題**:

1. **録音の不安**
   - ユーザーが録音中に「ちゃんと録音できているか」という不安を感じる
   - 確認のために録音を中断すると思考が浅くなる

2. **コンテンツの放置**
   - 録音したファイルを管理できず放置してしまう
   - 文字起こしが手間で活用できない

3. **ワークフロー効率**
   - 音声入力から文字起こしまでのワークフローが分断されている
   - 複数のツールを使い分ける必要がある

**提供する価値**:

1. **安心感**
   - リアルタイム音量レベルメーターで録音状態を常時確認
   - 視覚的フィードバックによる確実性

2. **自動化**
   - 録音停止後、自動的に文字起こしが実行される
   - Markdown形式で即座に活用可能

3. **シンプルさ**
   - ホットキー一つで録音開始/停止
   - メニューバーに常駐し、すぐにアクセス可能

---

## 2. ユーザーストーリー

### 2.1 ペルソナ1: コンテンツクリエイター（田中さん、30歳）

**背景**:
- YouTubeで週2本の動画を投稿
- 台本作成に時間がかかることが悩み
- 音声で思いついたアイデアを記録したい

**シナリオ**:
1. 散歩中にアイデアが浮かぶ
2. `Cmd + Shift + R`で録音開始
3. メニューバーアイコンが赤色になり、録音中を確認
4. アイデアを話す
5. 再度`Cmd + Shift + R`で録音停止
6. 帰宅後、Markdownファイルを開いて台本を整形
7. **Before**: メモアプリに手入力、または後でボイスメモを聞き返す
8. **After**: 即座に文字起こしされたMarkdownファイルを編集

### 2.2 ペルソナ2: 研究者（佐藤さん、45歳）

**背景**:
- 大学でインタビュー調査を実施
- 音声データの文字起こしに膨大な時間がかかる
- 正確な記録が必要

**シナリオ**:
1. インタビュー開始前にVoiceCaptureを起動
2. ホットキーで録音開始
3. インタビューを実施
4. 録音停止後、自動的に文字起こしが開始される
5. 数分後、Markdownファイルが生成される
6. ファイルを開いて確認、必要に応じて編集
7. **Before**: 外部サービスに依頼、または手動で文字起こし（数時間）
8. **After**: 自動文字起こしで数分で完了

### 2.3 ペルソナ3: ビジネスパーソン（山田さん、35歳）

**背景**:
- リモート会議が多い
- 議事録作成が負担
- 重要な発言を漏らしたくない

**シナリオ**:
1. 会議開始時にVoiceCaptureで録音開始
2. 会議中、録音時間を確認しながら議論
3. 会議終了後、録音停止
4. 自動文字起こしが完了
5. Markdownファイルを確認し、議事録として整形
6. **Before**: 手動でメモを取る、または会議後に記憶を頼りに議事録作成
7. **After**: 正確な文字起こしをベースに効率的に議事録作成

---

## 3. 機能要件

### 3.1 録音機能

#### 3.1.1 グローバルホットキー

- [ ] ユーザーが設定した任意のキーコンビネーションで録音開始/停止
- [ ] トグル式：同じキーで開始と停止
- [ ] デフォルトキー：`Command + Shift + R`
- [ ] 設定で変更可能
- [ ] 他のアプリケーションと競合しない仕組み

#### 3.1.2 視覚的フィードバック

**メニューバーアイコン**:
- [ ] 通常時：マイクアイコン（グレー）
- [ ] 録音中：マイクアイコン（赤色）または点滅
- [ ] アイコンの切り替えがスムーズ

**録音時間表示**:
- [ ] フォーマット：`mm:ss`
- [ ] メニューバーまたはポップアップに表示
- [ ] リアルタイムで更新

**音量レベルメーター**:
- [ ] リアルタイムで音量を可視化
- [ ] ユーザーが「録音できている」ことを確認できる
- [ ] 音量に応じて色が変化（緑→黄→赤）

#### 3.1.3 録音品質

**フォーマット**:
- [ ] デフォルト：WAV（非圧縮）
- [ ] サンプルレート：44.1kHz（デフォルト）
- [ ] 設定で16kHz, 22.05kHz, 44.1kHz, 48kHzから選択可能
- [ ] ビット深度：16bit（デフォルト）
- [ ] 設定で16bit/24bitから選択可能
- [ ] チャンネル：モノラル（デフォルト）
- [ ] 設定でステレオも選択可能

### 3.2 自動保存機能

#### 3.2.1 ファイル名規則

- [ ] 形式：`YYYYMMDD_HHMMSS.wav`
- [ ] 例：`20251003_143022.wav`
- [ ] 日時は録音開始時刻を使用
- [ ] タイムゾーン：システムのローカルタイム

#### 3.2.2 保存先

- [ ] ユーザーが設定で指定したフォルダに保存
- [ ] デフォルト：`~/Documents/VoiceCapture/`
- [ ] フォルダが存在しない場合は自動作成
- [ ] 保存先の変更が即座に反映される

#### 3.2.3 保存完了通知

- [ ] macOS通知センターに通知を表示
- [ ] タイトル：「録音完了」
- [ ] 本文：「ファイル名: YYYYMMDD_HHMMSS.wav」
- [ ] アクション：「Finderで開く」ボタン
- [ ] クリックでFinderが開きファイルを選択状態で表示

### 3.3 文字起こし機能

#### 3.3.1 文字起こしエンジン

- [ ] 使用モデル：Whisper medium（MLX Swift版）
- [ ] 実装方法：MLX Swift（Apple Silicon最適化）
- [ ] 言語：日本語（ja）を指定
- [ ] 高精度な認識

#### 3.3.2 実行タイミング

- [ ] 録音停止直後に自動実行（デフォルト）
- [ ] 設定で自動実行ON/OFFを切り替え可能
- [ ] 手動実行オプション（将来的な拡張）

#### 3.3.3 文字起こし中のフィードバック

- [ ] メニューバーアイコンに処理中インジケーター表示
- [ ] 通知またはポップアップで「文字起こし中...」を表示
- [ ] 進捗率を表示（0-100%）
- [ ] キャンセルボタン（将来的な拡張）

#### 3.3.4 出力フォーマット（Markdown）

**ファイル名**:
- [ ] `YYYYMMDD_HHMMSS.md`（WAVファイルと同名）

**フォーマット**:
```markdown
# 録音 YYYY-MM-DD HH:MM:SS

**録音日時**: YYYY年MM月DD日 HH:MM:SS
**録音時間**: mm:ss
**ファイル名**: YYYYMMDD_HHMMSS.wav

---

[文字起こし内容がここに入る]
```

#### 3.3.5 文字起こし完了通知

- [ ] macOS通知センターに通知を表示
- [ ] タイトル：「文字起こし完了」
- [ ] 本文：「ファイル名: YYYYMMDD_HHMMSS.md」
- [ ] アクション：「ファイルを開く」ボタン
- [ ] クリックでMarkdownファイルがデフォルトエディタで開く

### 3.4 設定画面（GUI）

#### 3.4.1 設定項目

**1. ホットキー設定**:
- [ ] キーコンビネーションを記録するUI
- [ ] 現在の設定を表示
- [ ] 「録音するキーを押してください」プロンプト
- [ ] リアルタイムで登録
- [ ] バリデーション（他アプリとの競合チェック）

**2. 保存先フォルダ**:
- [ ] フォルダ選択ダイアログ
- [ ] 現在の保存先パスを表示
- [ ] 「フォルダを選択」ボタン
- [ ] 選択後即座に反映

**3. 文字起こし設定**:
- [ ] 自動実行ON/OFF（チェックボックス）
- [ ] Whisperモデル選択（将来的にsmall/medium/large）
- [ ] 現状はmedium固定

**4. 録音品質設定**:
- [ ] サンプルレート選択（ドロップダウン）
  - 16kHz
  - 22.05kHz
  - 44.1kHz（デフォルト）
  - 48kHz
- [ ] ビット深度選択（ドロップダウン）
  - 16bit（デフォルト）
  - 24bit
- [ ] チャンネル選択（ラジオボタン）
  - モノラル（デフォルト）
  - ステレオ

#### 3.4.2 設定の保存

- [ ] UserDefaultsを使用してローカルに保存
- [ ] アプリ再起動時に設定を復元
- [ ] 設定変更が即座に反映される

### 3.5 メニューバー機能

#### 3.5.1 メニュー項目

**基本メニュー**:
- [ ] **録音開始/停止** - ホットキーと同じ機能
- [ ] **最後の録音を開く** - Finderで最新のWAVファイルを表示
- [ ] **最後の文字起こしを開く** - 最新のMDファイルをデフォルトエディタで開く
- [ ] **---**（セパレーター）
- [ ] **設定...** - 設定画面を開く
- [ ] **VoiceCaptureについて** - バージョン情報等
- [ ] **終了** - アプリを終了

**動的メニュー**:
- [ ] 録音中は「録音開始」が「録音停止」に変わる
- [ ] 録音履歴が存在しない場合、「最後の録音を開く」は無効化

---

## 4. 非機能要件

### 4.1 パフォーマンス

#### 4.1.1 応答性

- [ ] ホットキー押下から録音開始まで：0.5秒以内
- [ ] メニューバーアイコン更新：即座（100ms以内）
- [ ] 音量レベルメーター更新：100ms以内

#### 4.1.2 文字起こし速度

- [ ] 1分の音声を30秒以内で処理
- [ ] リアルタイム係数（RTF）：0.5以下
- [ ] Apple Silicon（M1以降）での最適化

#### 4.1.3 メモリ使用量

- [ ] アイドル時：100MB以下
- [ ] 録音中：200MB以下
- [ ] 文字起こし中：2GB以下（モデルロード含む）

### 4.2 ユーザビリティ

#### 4.2.1 学習容易性

- [ ] 初回起動時にクイックツアー表示（将来的な拡張）
- [ ] 設定画面に簡潔な説明を表示
- [ ] エラーメッセージが分かりやすい

#### 4.2.2 アクセシビリティ

- [ ] VoiceOverサポート
- [ ] キーボードナビゲーション
- [ ] ハイコントラストモード対応（将来的な拡張）

### 4.3 セキュリティとプライバシー

#### 4.3.1 権限管理

- [ ] マイクへのアクセス権限を適切にリクエスト
- [ ] Info.plistに明確な使用目的を記載
- [ ] 権限が拒否された場合の適切なエラーメッセージ

#### 4.3.2 データ保護

- [ ] ローカルに保存（クラウド送信なし）
- [ ] ファイル保護レベル：`completeFileProtection`
- [ ] ユーザーデータの外部送信なし

#### 4.3.3 サンドボックス

- [ ] App Sandboxを有効化
- [ ] 必要最小限の権限のみ要求
- [ ] ユーザー選択ファイルへのアクセスのみ許可

### 4.4 信頼性

#### 4.4.1 エラーハンドリング

- [ ] 録音失敗時の適切なエラーメッセージ
- [ ] 文字起こし失敗時のリトライ機能（3回まで）
- [ ] ディスク容量不足時の警告
- [ ] マイクデバイス接続エラーの検出

#### 4.4.2 データ整合性

- [ ] 録音ファイルの破損チェック
- [ ] 文字起こし結果の検証
- [ ] ファイル保存時のアトミック書き込み

### 4.5 互換性

#### 4.5.1 システム要件

- [ ] macOS 12.0 (Monterey) 以降
- [ ] Apple Silicon（M1/M2/M3/M4）
- [ ] メモリ：8GB以上推奨
- [ ] ストレージ：3GB以上の空き容量（モデル含む）

#### 4.5.2 ファイル形式

- [ ] WAV：標準的なPCM形式
- [ ] Markdown：CommonMark準拠
- [ ] 他のアプリケーションとの互換性を確保

---

## 5. 成功基準

### 5.1 定量的指標

#### 5.1.1 パフォーマンス

- [ ] ホットキー応答時間：平均0.3秒以下
- [ ] 録音開始までの時間：0.5秒以下
- [ ] 文字起こし速度：RTF 0.5以下
- [ ] アプリ起動時間：2秒以内

#### 5.1.2 精度

- [ ] 日本語認識精度：主観評価で80%以上
- [ ] ファイル保存成功率：99.9%以上
- [ ] 通知表示成功率：99%以上

#### 5.1.3 安定性

- [ ] クラッシュ率：0.1%以下
- [ ] メモリリーク：なし
- [ ] 連続稼働時間：24時間以上

### 5.2 定性的指標

#### 5.2.1 ユーザー満足度

- [ ] 「録音の不安が解消された」と感じるユーザー：80%以上
- [ ] 「操作が簡単」と感じるユーザー：90%以上
- [ ] 「文字起こし精度に満足」と感じるユーザー：75%以上

#### 5.2.2 ユーザビリティ

- [ ] 初回使用時に説明なしで録音できる：80%以上
- [ ] 設定変更が直感的：85%以上
- [ ] エラーメッセージが理解しやすい：90%以上

---

## 6. 将来的な拡張機能（Phase 2以降）

以下の機能はMVP（Phase 1）には含まれないが、将来的な拡張として検討：

### 6.1 音声処理機能

- [ ] オーディオエフェクト（ノイズリダクション、ディエッサー）
- [ ] 音量の自動調整（ノーマライゼーション）
- [ ] 音声品質の自動分析と最適化提案

### 6.2 AI機能拡張

- [ ] Claude/Gemini APIを使った自動タグ付け
- [ ] カテゴリ自動分類
- [ ] サマリー自動生成
- [ ] 要約機能
- [ ] キーワード抽出

### 6.3 検索と管理

- [ ] 全文検索機能
- [ ] 録音履歴の一覧表示
- [ ] タグ管理
- [ ] スマートフォルダ
- [ ] カレンダー表示

### 6.4 エクスポート機能

- [ ] ポッドキャスト書き出し（MP3エンコード）
- [ ] 動画への音声追加
- [ ] 字幕ファイル（SRT）生成
- [ ] PDF出力

### 6.5 統合機能

- [ ] Obsidian連携
- [ ] Notion連携
- [ ] Evernote連携
- [ ] Dropbox自動同期

### 6.6 UI/UX改善

- [ ] ダークモード対応
- [ ] カスタムテーマ
- [ ] ウィジェット表示
- [ ] Touch Barサポート（古いMacBook Pro用）

---

## 7. 制約事項

### 7.1 技術的制約

#### 7.1.1 プラットフォーム

- [ ] macOS専用（Windows、Linuxは未対応）
- [ ] Apple Silicon専用（Intel Macは未対応）
- [ ] iOS版は当面予定なし

#### 7.1.2 モデル

- [ ] Whisper mediumモデル固定（他サイズは将来対応）
- [ ] 日本語専用（多言語は将来対応）
- [ ] オフライン動作のみ（クラウドAPIは未使用）

### 7.2 ビジネス制約

#### 7.2.1 配布

- [ ] 初期版はDMG配布のみ
- [ ] App Store配布は将来検討
- [ ] 無料版のみ（有料プランは将来検討）

#### 7.2.2 サポート

- [ ] GitHubでのissue対応のみ
- [ ] 公式サポートは提供しない
- [ ] コミュニティベースのサポート

### 7.3 リソース制約

#### 7.3.1 開発期間

- [ ] MVP完成：3-4週間（15営業日）
- [ ] 単独開発者
- [ ] フルタイム想定

#### 7.3.2 予算

- [ ] Apple Developer Program: $99/年
- [ ] その他費用なし（オープンソースツールのみ使用）

---

## 8. リスクと対策

### 8.1 技術リスク

#### 8.1.1 MLX Swift統合の複雑性

**リスク**: MLX SwiftのWhisperサポートが不十分
**影響度**: 高
**確率**: 中
**対策**:
- Phase 3の初期2日でGo/No-Go判断
- Python Bridge実装をフォールバックプランとして準備

#### 8.1.2 パフォーマンス問題

**リスク**: 文字起こし速度が要件を満たさない
**影響度**: 中
**確率**: 低
**対策**:
- Apple Siliconの最適化活用
- モデルサイズの調整（medium→small）

#### 8.1.3 メモリ使用量

**リスク**: メモリ使用量が大きすぎる
**影響度**: 中
**確率**: 中
**対策**:
- ストリーミング録音でメモリ使用を最小化
- 定期的なメモリ解放

### 8.2 ユーザビリティリスク

#### 8.2.1 ホットキー競合

**リスク**: 他のアプリケーションとホットキーが競合
**影響度**: 低
**確率**: 低
**対策**:
- カスタマイズ可能なホットキー
- 競合検出機能

### 8.3 配布リスク

#### 8.3.1 Notarization

**リスク**: macOSのセキュリティ要件を満たせない
**影響度**: 中
**確率**: 低
**対策**:
- 初期から適切な署名とNotarization対応
- テスト配布で検証

---

## 9. 承認状態

### 9.1 仕様レビュー

- [ ] ステークホルダーレビュー完了
- [ ] 技術レビュー完了
- [ ] UXレビュー完了

### 9.2 承認

- [ ] プロダクトオーナー承認
- [ ] 技術リード承認
- [ ] 最終承認

---

## 10. 変更履歴

| 日付 | バージョン | 変更内容 | 変更者 |
|------|-----------|---------|--------|
| 2025-10-03 | 1.0.0 | 初版作成 | Development Team |

---

## 11. 参考資料

### 11.1 関連ドキュメント

- [実装計画書](/Users/kk/development/mudai_voice/plan/implementation_plan_mlx_swift.md)
- [技術調査メモ](/Users/kk/development/mudai_voice/docs/mlx_swift_investigation.md)
- [MVP仕様書（原案）](/Users/kk/development/mudai_voice/plan/mvp_ver01.md)

### 11.2 外部リソース

- [Whisper論文](https://arxiv.org/abs/2212.04356)
- [MLX Swift GitHub](https://github.com/ml-explore/mlx-swift)
- [macOS Human Interface Guidelines](https://developer.apple.com/design/human-interface-guidelines/macos)

---

**最終更新日**: 2025-10-03
**作成者**: VoiceCapture Development Team
**バージョン**: 1.0.0
**ステータス**: 仕様定義完了

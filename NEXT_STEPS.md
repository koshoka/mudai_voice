# 次回のアクション

**最終更新**: 2025-10-04
**現在の状態**: Phase 3完了・日本語文字起こし動作確認済み

---

## ✅ 完了: 日本語文字起こし問題の解決（2025-10-04）

### 達成内容
- ✅ 日本語文字起こしが正常に動作することを確認
- ✅ DecodingOptions設定の最適化完了
- ✅ 詳細な検証ログの追加
- ✅ 設定ウィンドウの最前面表示機能追加
- ✅ 句読点付与プロンプトの実装（効果は限定的）

### 判明した事実
- distil-large-v3は英語専用モデル（日本語非対応）
- large-v3, medium, smallは多言語対応で日本語文字起こし可能
- 句読点はWhisperモデルの特性上、短い音声では付きにくい
- LLMは句読点なし日本語も大体は理解可能

---

## 優先度1: 継続的な利用とフィードバック収集

### 目的
日常的な利用を通じて、実用性を評価し、必要に応じて改善する。

### 推奨される運用方法
1. **録音と文字起こし**
   - large-v3モデルで日本語録音
   - 文字起こし結果を確認

2. **Claude Codeでの編集・整形**
   - 文字起こし結果をファイル保存
   - Claude Codeに「このファイルに句読点付けて」と指示
   - 箇条書きや構造化など、目的に応じた編集を依頼
   - **メリット**: API課金なし、Maxプランの範囲内で活用

3. **評価項目**
   - 文字起こし精度
   - 句読点の必要性
   - Claude Code編集の効率性
   - パフォーマンス

### Claude Codeでの文字起こし編集例

```
そなた: 「/path/to/transcription.mdに句読点を付けて、読みやすく整形してくれ」

メリア: （ファイルを読み、句読点付与、整形、保存）

そなた: 「今度は箇条書きにまとめてくれ」

メリア: （箇条書き化して保存）
```

完全にMaxプランの範囲内で実現可能。API課金なし。

---

## 優先度2: テスト作成（任意）

### 目的
コードの品質と保守性を向上させるため、自動テストを作成する。

### ユニットテスト

テスト対象:
- RecordingViewModel
- TranscriptionViewModel
- AudioRecordingService（モック使用）
- FileStorageService
- NotificationService

### 統合テスト

テストシナリオ:
- 録音開始→停止→ファイル保存フロー
- 録音→文字起こし→Markdown保存フロー
- パーミッションエラーハンドリング
- 通知からのアクション実行

### 所要時間
4〜6時間

### 優先度判断
**推奨**: 実機テスト完了後、必要性を感じた場合に実施

---

## 優先度3: マイク選択機能の実装（将来対応）

### 現状
- UI表示のみ
- 実際の録音には反映されない
- 理由: AVAudioRecorderは特定デバイス指定に非対応

### 実装に必要なこと

#### ステップ1: AudioRecordingServiceのリファクタリング

変更内容:
```
AVAudioRecorder ベース
↓
AVAudioEngine + AVCaptureDevice ベース
```

影響範囲:
- AudioRecordingService.swift 全体
- 録音処理の完全な書き換え
- テストの再実施

推定工数: 4〜6時間

#### ステップ2: テスト実施

確認項目:
- [ ] デフォルトマイクでの録音
- [ ] 外部マイクでの録音
- [ ] iPhone Mirroring経由のマイク
- [ ] 音質の確認
- [ ] ファイルサイズの比較

### 優先度判断

**推奨**: 実機テスト完了後、必要性を感じた場合に実施

理由:
- 現在の録音機能は正常動作している
- マイク選択は「あると便利」だが必須ではない
- 実機テストで優先度を再評価すべき

---

## 参考: 現在の実装状態（2025-10-04時点）

### 実装完了・動作確認済み機能

**Phase 1: 基本録音機能**
- ✅ 録音開始/停止、WAV保存
- ✅ 通知機能
- ✅ 権限管理（マイク・通知）

**Phase 2: ホットキーと設定**
- ✅ グローバルホットキー（Option + P）
- ✅ 設定画面UI（音質、保存先、Whisperモデル選択）
- ✅ 設定ウィンドウの最前面表示（2025-10-04追加）
- ✅ マイク選択UI（表示のみ）

**Phase 3: WhisperKit統合**
- ✅ WhisperKit統合（distil-large-v3, large-v3, medium, small選択可能）
- ✅ TranscriptionService完全実装
- ✅ 日本語文字起こし動作確認済み（2025-10-04）
- ✅ DecodingOptions最適化（task, detectLanguage設定）
- ✅ 詳細な検証ログ（モデル情報、設定、結果）
- ✅ 句読点付与プロンプト実装（効果は限定的）
- ✅ 自動文字起こしワークフロー
- ✅ Markdown出力機能
- ✅ 文字起こしファイルを開く機能

**Phase 4: UX改善**
- ✅ 録音中パルスアニメーション
- ✅ リッチ通知（録音時間・ファイルサイズ・文字数表示）
- ✅ エラーハンドリング強化
- ✅ 通知からのファイル削除機能

### 実運用可能な状態
- ✅ 日本語音声の文字起こしが正常動作
- ✅ large-v3モデルで高精度な文字起こし
- ✅ Claude Codeでの編集・整形ワークフロー確立

### 判明した技術的知見
- distil-large-v3は英語専用（日本語非対応）
- large-v3, medium, smallは多言語対応
- 句読点はWhisperの特性上、短い音声では付きにくい
- LLMは句読点なし日本語も概ね理解可能

### 既知の制限事項
- ⚠️ マイク選択がUI表示のみ（実録音には反映されない）
- ⚠️ 句読点の自動付与は限定的（Claude Codeでの後処理を推奨）

---

## 次回の作業開始時のチェックリスト

### 準備
- [ ] `/Users/kk/development/mudai_voice/PROGRESS.md` を確認
- [ ] このファイル（NEXT_STEPS.md）を確認
- [ ] VoiceCaptureアプリを起動

### 推奨作業フロー
1. **日常的な利用**
   - 録音と文字起こしを日常的に使用
   - 精度やパフォーマンスを評価

2. **Claude Codeでの編集・整形**
   - 文字起こし結果に句読点付与
   - 必要に応じて構造化や箇条書き化
   - API課金なし、Maxプランの範囲内

3. **フィードバック収集**（必要に応じて）
   - 改善点があれば記録
   - 新機能の要望があれば検討

### いつでも確認できる情報
- **詳細な進捗**: `/Users/kk/development/mudai_voice/PROGRESS.md`
- **コミット履歴**: `git log --oneline`

---

**現在の状態**: Phase 3完了・実運用可能（2025-10-04）
**最後の主要な実装**: 日本語文字起こし問題の解決、設定ウィンドウ最前面表示、句読点プロンプト追加
